/* FontAwesome is not built-in, but used for icons */
@import "@bryntum/schedulerpro/fontawesome/css/fontawesome.css";
@import "@bryntum/schedulerpro/fontawesome/css/solid.css";

/* Bryntum structural CSS */
@import "@bryntum/schedulerpro/schedulerpro.css";

/* Bryntum theme is included in index.html to enable runtime theme switching, but it could instead be included here if you want to use a single theme */
/* @import "@bryntum/schedulerpro/svalbard-light.css"; /*

/* Bryntum shared demo styling, not needed in your app */
@import "@bryntum/demo-resources/scss/example.scss";

html, body, #root {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden; // Prevent body scroll
}

.app-wrapper {
    height: 100vh;
    background: #f3f4f6;
    display: flex;
    flex-direction: column;
    overflow: hidden; // Prevent wrapper scroll
}

.app-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
}

body #content.demo-app.caire-layout {
    display : grid !important;
    grid-template-columns: 1fr auto auto; // Scheduler takes remaining space, panels auto-size
    grid-template-rows: 1fr; // Fill available height
    gap: 24px;
    max-width: none; // Remove max-width to use full screen
    margin: 0;
    padding: 24px;
    flex: 1; // Fill remaining space after header
    overflow: hidden; // Prevent content scroll
    min-height: 0; // Allow grid to shrink below content size
    
    // Allow scrolling for mode views that need it
    &.scrollable {
        overflow-y: auto;
        overflow-x: hidden;
    }

    .scheduler-container {
        grid-column: 1;
        min-height: 0; // Allow flex shrinking
        min-width: 600px; // Maintain minimum width
    }

    .b-splitter {
        display: none; // Hide splitter in grid layout
    }

    .grid-container {
        grid-column: 2;
        min-height: 0; // Allow flex shrinking
        width: 350px; // Fixed width when expanded
    }
    
    .grid-container-collapsed {
        grid-column: 2;
        min-height: 0;
        width: 50px; // Narrow when collapsed
    }

    .insights-panel {
        grid-column: 3;
        min-height: 0; // Allow flex shrinking
        width: 400px; // Fixed width when expanded
    }
    
    .insights-panel-collapsed {
        grid-column: 3;
        min-height: 0;
        width: 50px; // Narrow when collapsed
    }
}

.scheduler-container {
    min-width : 600px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%; // Fill grid cell height
    min-height: 0; // Allow flex shrinking
}

.grid-container {
    min-width : 300px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%; // Fill grid cell height
    min-height: 0; // Allow flex shrinking
}

.grid-container-collapsed,
.insights-panel-collapsed {
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    height: 100%; // Fill grid cell height
    min-height: 0;
    min-width: 50px; // Minimum width for collapsed state
}

.insights-panel {
    display: flex;
    flex-direction: column;
    height: 100%; // Fill grid cell height
    min-height: 0; // Allow flex shrinking
    overflow: hidden; // Hide overflow, let content scroll
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    
    > .panel-header {
        flex: 0 0 auto; // Fixed height header
        flex-shrink: 0; // Prevent header from shrinking
    }
    
    .insights-panel-content {
        flex: 1 1 auto; // Take remaining space and allow shrinking
        overflow-y: auto !important; // Force vertical scrolling
        overflow-x: hidden; // Hide horizontal scroll
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        min-height: 0; // CRITICAL: Allow flex shrinking below content size
        max-height: 100%; // Prevent exceeding parent height
    }
}

// Collapsed panel expand buttons - part of grid layout, not fixed overlay
.panel-expand-btn {
    writing-mode: vertical-rl;
    padding: 20px 12px;
    border: none;
    background: white;
    color: #6b7280;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 50px; // Fixed width for collapsed state
    height: 100%; // Fill grid cell height
    min-height: 0;
    position: relative; // Ensure proper stacking
    z-index: 10; // Ensure button is above other elements
    pointer-events: auto; // Ensure button is clickable
    
    i {
        font-size: 18px;
        transform: rotate(90deg); // Rotate icon for vertical text
        pointer-events: none; // Prevent icon from blocking clicks
    }
    
    span {
        transform: rotate(180deg); // Rotate text for vertical display
        pointer-events: none; // Prevent text from blocking clicks
    }
    
    &:hover {
        background: linear-gradient(135deg, #e0f2fe, #e0f7fa);
        color: #3b82f6;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }
    
    &:active {
        transform: scale(0.98); // Visual feedback on click
    }
}

.b-toolbar:not(.b-outer) {
    height : 6em;
}

.b-filter-bar-compact {
    .b-filter-bar-field {
        .b-field-inner input {
            &:not(:focus)::placeholder {
                color : var(--b-neutral-70);
            }
        }

        .b-field-trigger.fa-filter {
            display : flex !important;
            margin  : 0 0.5em;
            order   : -1;
        }
    }
}

:is(.scheduler-container, .grid-container) {
    display        : flex;
    flex-direction : column;

    > :first-child {
        flex : 0 0 auto;
    }
    
    // Make Bryntum components fill remaining space
    > .b-scheduler-pro,
    > .b-grid {
        flex: 1;
        min-height: 0; // Allow shrinking
        overflow: auto; // Enable scrolling for scheduler
    }
}

div.b-resource-info {
    --b-avatar-size : 3em;
}

.b-unplanned-grid {
    --b-toolbar-gap : 0;

    .fa-clock {
        margin-inline-end : 0 !important;
    }

    .name-container {
        display             : flex;
        flex-direction      : column;
        margin-inline-start : 0.3em;
    }
}

.patient-name {
    font-size  : 0.8em;
    margin-top : 0.2em;
}

.b-drag-proxy {
    opacity : 1;

    .b-unassigned-class {
        pointer-events : none;
        transform      : none !important;

        &:first-child {
            z-index : 100;
        }

        .b-sch-event {
            opacity : 1;
            margin  : 5px 0;
        }
    }

    &.b-drag-invalid {
        --b-primary : var(--b-color-red);
    }
}

.b-aborting.b-unassigned-class {
    transition     : transform 0.3s !important;
    position       : absolute !important;
    z-index        : 10000;
    pointer-events : none;
    opacity        : 0.8;
    box-sizing     : border-box;

    --b-primary    : var(--b-color-red);
}

.b-sch-event {
    --b-sch-event-box-shadow : var(--b-elevation-1);

    .patient-name {
        font-weight : 400;
    }
}

.b-sch-highlighted-calendar-range {
    animation : fadein 0.5s;
}

[data-assignment-id*="_generated"] .sch-event {
    opacity : 0.4;
    filter  : grayscale(1);
}

@keyframes fadein {
    0% {
        opacity : 0;
    }
    100% {
        opacity : 1;
    }
}

.b-exceeds-axis-width {
    clip-path : polygon(0% 0%, calc(100% - 2em) 0%, 100% 50%, calc(100% - 2em) 100%, 0% 100%);
}

// Lunch break styling - striped/dotted frame, empty background (not taking visual priority)
.b-sch-resourcetimerange.lunch-break {
    background: transparent !important;  // Empty background
    border: 2px dotted rgba(107, 114, 128, 0.5) !important;  // Dotted frame
    border-radius: 4px;
}

// ===== VISUAL SYSTEM (see VISUAL_SYSTEM.md) =====

// 1. Visit Status Colors - ONLY 2 background colors: Optional (blue) or Mandatory (purple)
// Every visit is either optional or mandatory - this is the base background
// Extra, Cancelled, Absent, and Priority use overlays (borders/patterns/icons)
.b-sch-event {
    // Base status backgrounds - ONLY 2 colors
    &.visit-status-optional {
        background: #3b82f6 !important;  // Blue - Optional/standard visit
        color: white;
    }
    
    &.visit-status-mandatory {
        background: #8b5cf6 !important;  // Purple - Mandatory (can't skip)
        color: white;
    }
    
    // Overlay indicators - use borders/patterns/icons, NOT background colors
    // These overlay on top of the base optional/mandatory background
    
    // Extra: Green vertical stripes + thick green left border
    &.visit-has-extra {
        background-image: repeating-linear-gradient(
            90deg,
            transparent,
            transparent 4px,
            rgba(16, 185, 129, 0.4) 4px,
            rgba(16, 185, 129, 0.4) 8px
        ) !important;
        border-left: 4px solid #10b981 !important;  // Thick green left border
        box-shadow: inset 3px 0 0 rgba(16, 185, 129, 0.2);
    }
    
    // Cancelled: Yellow diagonal stripe pattern + dashed border
    &.visit-has-cancelled {
        background-image: repeating-linear-gradient(
            -45deg,
            transparent,
            transparent 6px,
            rgba(251, 191, 36, 0.4) 6px,
            rgba(251, 191, 36, 0.4) 12px
        ) !important;
        border: 2px dashed #fbbf24 !important;  // Yellow dashed border
        opacity: 0.7;
    }
    
    // Absent: Grey horizontal stripes + dotted border
    &.visit-has-absent {
        background-image: repeating-linear-gradient(
            0deg,
            transparent,
            transparent 4px,
            rgba(156, 163, 175, 0.4) 4px,
            rgba(156, 163, 175, 0.4) 8px
        ) !important;
        border: 2px dotted #9ca3af !important;  // Grey dotted border all around
        opacity: 0.6;
    }
    
    // Priority is NOT a visual overlay - it's just a number (0-10) for filtering
    // No CSS styling for priority - use the priority slider to filter
    
    // Combinations: Multiple overlays can combine
    &.visit-has-extra.visit-has-cancelled {
        // Extra + Cancelled: Green diagonal + yellow dashed border
        border: 2px dashed #fbbf24 !important;
        border-left: 3px solid #10b981 !important;
    }
}

// 2. Badge Icons (Top-Right Corner)
// Using more specific selector to ensure styles apply within Bryntum events
.b-sch-event,
.b-sch-event-wrap .b-sch-event {
    position: relative !important;
    overflow: visible !important; // Ensure badges don't get clipped
    
    .event-badges {
        position: absolute !important;
        top: 2px;
        right: 2px;
        display: flex !important;
        gap: 3px;
        z-index: 100; // Higher z-index to ensure visibility
        
        .badge-icon {
            min-width: 18px;
            height: 18px;
            padding: 0 4px;
            display: flex !important;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            color: #1f2937;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
        }
        
        .recurrence-badge {
            display: flex !important;
            align-items: center;
            gap: 2px;
            font-size: 9px;
            font-weight: 700;
            color: #1f2937;
            
            i {
                font-size: 10px;
                color: #6b7280;
            }
        }
    }
}

// Event content styling
.event-content {
    padding: 6px;
    line-height: 1.4;
    font-size: 12px;
    
    .event-name {
        font-weight: 600;
        margin-bottom: 2px;
    }
    
    .event-patient {
        font-size: 11px;
        color: #374151;
    }
    
    .event-travel {
        font-size: 10px;
        color: #3b82f6;
        margin-top: 2px;
    }
}

// Event buffer styling (EXACT copy from official Bryntum Travel Time example)
// IMPORTANT: Travel buffers should ALWAYS be neutral grey, regardless of parent event's visitStatus
.b-sch-horizontal .b-sch-event-wrap {
    .b-sch-event-buffer-before:not(.b-buffer-thin),
    .b-sch-event-buffer-after:not(.b-buffer-thin) {
        border-inline-start : 3px solid var(--b-event-buffer-color, #6b7280);
        // Force neutral background - never inherit parent event's visitStatus color
        background: rgba(107, 114, 128, 0.1) !important;  // Light grey background
        // Override any visit-status classes that might be inherited
        &.visit-status-priority,
        &.visit-status-mandatory,
        &.visit-status-optional,
        &.visit-status-extra,
        &.visit-status-cancelled,
        &.visit-status-absent {
            background: rgba(107, 114, 128, 0.1) !important;  // Always neutral grey
        }
    }
    
    .b-sch-event-buffer-before:not(.b-buffer-thin) {
        border-inline-start : 3px solid var(--b-event-buffer-color, #6b7280);
    }

    .b-sch-event-buffer-after:not(.b-buffer-thin) {
        border-inline-end : 3px solid var(--b-event-buffer-color, #6b7280);
    }
}

// Congestion or special travel conditions (only affects border color, not background)
.congestion {
    --b-event-buffer-color: var(--b-color-red);
    --b-event-buffer-label-color: var(--b-color-red);
    // Background still neutral even with congestion
    .b-sch-event-buffer-before,
    .b-sch-event-buffer-after {
        background: rgba(107, 114, 128, 0.1) !important;
    }
}

// Event content structure
.event-name {
    font-weight: 700;
    font-size: 13px;
    line-height: 1.3;
}

.event-patient {
    font-size: 11px;
    color: #6b7280;
    margin-top: 2px;
    line-height: 1.2;
}

// Removed panel-toggle buttons (redundant with collapse buttons in each panel)

// Panel headers
.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: white;
    border-radius: 12px 12px 0 0;
    border-bottom: 1px solid #e5e7eb;
    
    h3 {
        font-size: 16px;
        font-weight: 700;
        margin: 0;
        color: #1f2937;
    }
    
    .collapse-btn {
        padding: 4px 8px;
        border: none;
        background: transparent;
        color: #6b7280;
        cursor: pointer;
        border-radius: 4px;
        
        &:hover {
            background: #f3f4f6;
            color: #dc2626;
        }
    }
}

// Placeholder views
.placeholder-view {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem;
    background: white;
    border-radius: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    margin: 24px;
    
    .icon {
        font-size: 72px;
        margin-bottom: 1.5rem;
    }
    
    h2 {
        font-size: 28px;
        font-weight: 700;
        color: #1f2937;
        margin: 0 0 0.5rem 0;
    }
    
    > p {
        font-size: 16px;
        color: #6b7280;
        margin: 0 0 2rem 0;
    }
    
    .stats {
        display: flex;
        gap: 3rem;
        margin-bottom: 2rem;
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 2rem;
            background: #f9fafb;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            
            &.green {
                background: #f0fdf4;
                border-color: #86efac;
            }
            
            .label {
                font-size: 12px;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                color: #6b7280;
                margin-bottom: 0.5rem;
            }
            
            .value {
                font-size: 24px;
                font-weight: 700;
                color: #3b82f6;
            }
            
            &.green .value {
                color: #10b981;
            }
        }
    }
    
    .note {
        font-size: 13px;
        color: #6b7280;
        background: #fef3c7;
        padding: 12px 20px;
        border-radius: 8px;
        border: 1px solid #fbbf24;
        margin: 0;
    }
}

.mode-view-scrollable {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    min-height: 0;
}

.comparison-view,
.analysis-view {
    min-height: 600px;
    padding: 24px;
    background: #f3f4f6;
}

// Chart widget styles (from embedded-chart example - app.css line 20-35)
.b-utilization-chart {
    position: absolute;
    bottom: -6px;
    left: 0;
    display: none !important;
    background: transparent;

    .b-row-expanded & {
        display: block !important;

        /* Chart has some extra padding we have to eliminate to align the timeaxis start */
        .b-chart-content {
            margin-inline-start: -6px;
        }
    }
    
    svg {
        display: block;
        width: 100%;
    }
}

// Tree summary heatmap styles (from tree-summary-heatmap example)
.b-summary-value {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    font-size: 11px;
    font-weight: 600;
    color: #374151;
}

.analysis-heatmap-info {
    margin-top: 24px;
    padding: 16px;
    background: #f9fafb;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    
    p {
        margin: 8px 0;
        color: #374151;
        font-size: 14px;
        
        a {
            color: #3b82f6;
            text-decoration: underline;
        }
    }
}

.b-expand-button-cell {
    .b-button {
        background: transparent;
        border: none;
        color: #6b7280;
        cursor: pointer;
        transition: all 0.2s;

        &:hover {
            color: #3b82f6;
            background: #eff6ff;
            border-radius: 4px;
        }
    }
}

.analysis-loading {
    padding: 60px;
    text-align: center;
    color: #6b7280;
    font-size: 16px;
}

.analysis-view {
    .analysis-header {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

        h2 {
            margin: 0 0 16px 0;
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }

        .analysis-explanation {
            p {
                margin: 0 0 12px 0;
                font-size: 14px;
                color: #1f2937;
            }

            ul {
                margin: 0 0 16px 0;
                padding-left: 20px;
                color: #374151;

                li {
                    margin-bottom: 8px;
                    font-size: 14px;
                    line-height: 1.6;

                    strong {
                        color: #1f2937;
                    }
                }
            }

            .tip {
                padding: 12px 16px;
                background: #eff6ff;
                border-left: 4px solid #3b82f6;
                border-radius: 8px;
                margin: 0 !important;
                font-size: 13px;
                color: #1e40af;
            }
        }
    }

    .analysis-content {
        display: flex;
        flex-direction: column;
        gap: 16px;

        .analysis-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }
    }
}

// Optimization Progress Overlay
.optimization-progress-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10001;
    animation: progressFadeIn 0.2s ease-out;
}

@keyframes progressFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.optimization-progress-modal {
    background: white;
    border-radius: 16px;
    padding: 32px 40px;
    text-align: center;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    min-width: 320px;
    animation: slideUp 0.3s ease-out;

    .scenario-icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
        color: white;
        font-size: 28px;
    }

    h3 {
        margin: 0 0 20px;
        font-size: 18px;
        font-weight: 600;
        color: #1e293b;
    }

    .progress-bar {
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 12px;
    }

    .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.3s ease;
    }

    .progress-text {
        margin: 0 0 8px;
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
    }

    .progress-hint {
        margin: 0;
        font-size: 13px;
        color: #64748b;
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
